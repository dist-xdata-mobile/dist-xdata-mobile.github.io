<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图片加载 | Fellow Travellers</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <meta name="description" content="Fellow-Travellers documents for tech3D / mobile / calc / back-end">
    <link rel="preload" href="/assets/css/0.styles.e5f9f895.css" as="style"><link rel="preload" href="/assets/js/app.24ab3d2f.js" as="script"><link rel="preload" href="/assets/js/3.ae223e66.js" as="script"><link rel="preload" href="/assets/js/1.02cf7ae9.js" as="script"><link rel="preload" href="/assets/js/136.34155571.js" as="script"><link rel="prefetch" href="/assets/js/10.e7275784.js"><link rel="prefetch" href="/assets/js/100.d9491c22.js"><link rel="prefetch" href="/assets/js/101.b597c13c.js"><link rel="prefetch" href="/assets/js/102.4c7459a2.js"><link rel="prefetch" href="/assets/js/103.1c9747dd.js"><link rel="prefetch" href="/assets/js/104.c71d56dc.js"><link rel="prefetch" href="/assets/js/105.260aaf9f.js"><link rel="prefetch" href="/assets/js/106.c972e851.js"><link rel="prefetch" href="/assets/js/107.e2376f77.js"><link rel="prefetch" href="/assets/js/108.32a64a11.js"><link rel="prefetch" href="/assets/js/109.719f01a0.js"><link rel="prefetch" href="/assets/js/11.4c9b4d46.js"><link rel="prefetch" href="/assets/js/110.098b415a.js"><link rel="prefetch" href="/assets/js/111.d58749eb.js"><link rel="prefetch" href="/assets/js/112.b4bd956b.js"><link rel="prefetch" href="/assets/js/113.aa2bed70.js"><link rel="prefetch" href="/assets/js/114.68eddcfa.js"><link rel="prefetch" href="/assets/js/115.07baa390.js"><link rel="prefetch" href="/assets/js/116.be414d7b.js"><link rel="prefetch" href="/assets/js/117.d0d1a156.js"><link rel="prefetch" href="/assets/js/118.0f217bd0.js"><link rel="prefetch" href="/assets/js/119.ed7e911b.js"><link rel="prefetch" href="/assets/js/12.77e0d4e1.js"><link rel="prefetch" href="/assets/js/120.4268db58.js"><link rel="prefetch" href="/assets/js/121.a1fabb59.js"><link rel="prefetch" href="/assets/js/122.a8f8afb8.js"><link rel="prefetch" href="/assets/js/123.cd0337d5.js"><link rel="prefetch" href="/assets/js/124.53f839b5.js"><link rel="prefetch" href="/assets/js/125.29087754.js"><link rel="prefetch" href="/assets/js/126.73b06641.js"><link rel="prefetch" href="/assets/js/127.c15df3e7.js"><link rel="prefetch" href="/assets/js/128.4b622d18.js"><link rel="prefetch" href="/assets/js/129.eec23a90.js"><link rel="prefetch" href="/assets/js/13.faee7a70.js"><link rel="prefetch" href="/assets/js/130.1af66f4a.js"><link rel="prefetch" href="/assets/js/131.6696c658.js"><link rel="prefetch" href="/assets/js/132.3fbfe61b.js"><link rel="prefetch" href="/assets/js/133.2a98d40b.js"><link rel="prefetch" href="/assets/js/134.8ef5d3a3.js"><link rel="prefetch" href="/assets/js/135.753932d8.js"><link rel="prefetch" href="/assets/js/137.d1b34ead.js"><link rel="prefetch" href="/assets/js/138.45212dde.js"><link rel="prefetch" href="/assets/js/139.1c99686e.js"><link rel="prefetch" href="/assets/js/14.5e1b322f.js"><link rel="prefetch" href="/assets/js/140.62fd886e.js"><link rel="prefetch" href="/assets/js/141.590373f9.js"><link rel="prefetch" href="/assets/js/142.12c5641d.js"><link rel="prefetch" href="/assets/js/143.161a15ca.js"><link rel="prefetch" href="/assets/js/144.c79ba202.js"><link rel="prefetch" href="/assets/js/145.713910f8.js"><link rel="prefetch" href="/assets/js/146.fe23e26a.js"><link rel="prefetch" href="/assets/js/147.ca8f3b04.js"><link rel="prefetch" href="/assets/js/148.de0f7a57.js"><link rel="prefetch" href="/assets/js/149.e4034326.js"><link rel="prefetch" href="/assets/js/15.c64a0296.js"><link rel="prefetch" href="/assets/js/150.3bb80c41.js"><link rel="prefetch" href="/assets/js/151.59f060b6.js"><link rel="prefetch" href="/assets/js/152.0272a857.js"><link rel="prefetch" href="/assets/js/153.bc2da934.js"><link rel="prefetch" href="/assets/js/154.89ec0012.js"><link rel="prefetch" href="/assets/js/155.88c7ce2d.js"><link rel="prefetch" href="/assets/js/156.65bc67ce.js"><link rel="prefetch" href="/assets/js/157.9ce1e89f.js"><link rel="prefetch" href="/assets/js/158.9b5a7a8d.js"><link rel="prefetch" href="/assets/js/159.d3aeb115.js"><link rel="prefetch" href="/assets/js/16.f13c1a4b.js"><link rel="prefetch" href="/assets/js/160.262cdd64.js"><link rel="prefetch" href="/assets/js/161.9a6c7442.js"><link rel="prefetch" href="/assets/js/162.17602366.js"><link rel="prefetch" href="/assets/js/163.95960581.js"><link rel="prefetch" href="/assets/js/164.dab8d2fe.js"><link rel="prefetch" href="/assets/js/165.b6a6ebc3.js"><link rel="prefetch" href="/assets/js/166.e79f3098.js"><link rel="prefetch" href="/assets/js/167.1efeaca8.js"><link rel="prefetch" href="/assets/js/168.a02e5d8f.js"><link rel="prefetch" href="/assets/js/169.ae4e6391.js"><link rel="prefetch" href="/assets/js/17.e99ac461.js"><link rel="prefetch" href="/assets/js/170.c816925e.js"><link rel="prefetch" href="/assets/js/171.f26a925a.js"><link rel="prefetch" href="/assets/js/172.8343d102.js"><link rel="prefetch" href="/assets/js/173.7fa1ebef.js"><link rel="prefetch" href="/assets/js/174.20760d4a.js"><link rel="prefetch" href="/assets/js/175.30d21385.js"><link rel="prefetch" href="/assets/js/176.7e010e6e.js"><link rel="prefetch" href="/assets/js/177.516d6c9b.js"><link rel="prefetch" href="/assets/js/178.fa15b667.js"><link rel="prefetch" href="/assets/js/179.77b21239.js"><link rel="prefetch" href="/assets/js/18.2df0d7da.js"><link rel="prefetch" href="/assets/js/180.7af949ed.js"><link rel="prefetch" href="/assets/js/181.0ca97274.js"><link rel="prefetch" href="/assets/js/182.5d69cb31.js"><link rel="prefetch" href="/assets/js/183.6b437eec.js"><link rel="prefetch" href="/assets/js/184.9ab2be09.js"><link rel="prefetch" href="/assets/js/185.6713b8ec.js"><link rel="prefetch" href="/assets/js/186.9b592f14.js"><link rel="prefetch" href="/assets/js/187.3c51d982.js"><link rel="prefetch" href="/assets/js/188.1b8199d6.js"><link rel="prefetch" href="/assets/js/189.f1057605.js"><link rel="prefetch" href="/assets/js/19.74c2fe85.js"><link rel="prefetch" href="/assets/js/190.36072c89.js"><link rel="prefetch" href="/assets/js/191.499d698f.js"><link rel="prefetch" href="/assets/js/192.263a4d10.js"><link rel="prefetch" href="/assets/js/193.8fc88b41.js"><link rel="prefetch" href="/assets/js/194.406ef82d.js"><link rel="prefetch" href="/assets/js/195.8c94f51b.js"><link rel="prefetch" href="/assets/js/196.02df8beb.js"><link rel="prefetch" href="/assets/js/197.6b4b0107.js"><link rel="prefetch" href="/assets/js/198.5ceb1715.js"><link rel="prefetch" href="/assets/js/20.37ef7b5a.js"><link rel="prefetch" href="/assets/js/21.8edf360c.js"><link rel="prefetch" href="/assets/js/22.681f9ff8.js"><link rel="prefetch" href="/assets/js/23.6355d98a.js"><link rel="prefetch" href="/assets/js/24.0d068097.js"><link rel="prefetch" href="/assets/js/25.b8c6fba0.js"><link rel="prefetch" href="/assets/js/26.b76fcccf.js"><link rel="prefetch" href="/assets/js/27.b95d8356.js"><link rel="prefetch" href="/assets/js/28.37a344fe.js"><link rel="prefetch" href="/assets/js/29.717a72c0.js"><link rel="prefetch" href="/assets/js/30.55087dce.js"><link rel="prefetch" href="/assets/js/31.c151abfb.js"><link rel="prefetch" href="/assets/js/32.7a8f6337.js"><link rel="prefetch" href="/assets/js/33.ac183ed2.js"><link rel="prefetch" href="/assets/js/34.7d1e8694.js"><link rel="prefetch" href="/assets/js/35.a28b2867.js"><link rel="prefetch" href="/assets/js/36.e4b030f9.js"><link rel="prefetch" href="/assets/js/37.d2c79d7a.js"><link rel="prefetch" href="/assets/js/38.e9f9734a.js"><link rel="prefetch" href="/assets/js/39.41d4212f.js"><link rel="prefetch" href="/assets/js/4.09ef6149.js"><link rel="prefetch" href="/assets/js/40.4e231720.js"><link rel="prefetch" href="/assets/js/41.78793a6d.js"><link rel="prefetch" href="/assets/js/42.9e9728c2.js"><link rel="prefetch" href="/assets/js/43.806dbed8.js"><link rel="prefetch" href="/assets/js/44.f5808021.js"><link rel="prefetch" href="/assets/js/45.cd3b9402.js"><link rel="prefetch" href="/assets/js/46.f597a77f.js"><link rel="prefetch" href="/assets/js/47.42c52267.js"><link rel="prefetch" href="/assets/js/48.7a5795b7.js"><link rel="prefetch" href="/assets/js/49.4a0ef904.js"><link rel="prefetch" href="/assets/js/5.9ee91412.js"><link rel="prefetch" href="/assets/js/50.b089522d.js"><link rel="prefetch" href="/assets/js/51.cd200a2d.js"><link rel="prefetch" href="/assets/js/52.ddb691c6.js"><link rel="prefetch" href="/assets/js/53.9e959307.js"><link rel="prefetch" href="/assets/js/54.ebdd0492.js"><link rel="prefetch" href="/assets/js/55.3dbd94ea.js"><link rel="prefetch" href="/assets/js/56.d39f7dbe.js"><link rel="prefetch" href="/assets/js/57.6f1c287b.js"><link rel="prefetch" href="/assets/js/58.13e00c1a.js"><link rel="prefetch" href="/assets/js/59.69e8bd65.js"><link rel="prefetch" href="/assets/js/6.4c4772aa.js"><link rel="prefetch" href="/assets/js/60.fbdc4a90.js"><link rel="prefetch" href="/assets/js/61.d7cc6838.js"><link rel="prefetch" href="/assets/js/62.b6672e01.js"><link rel="prefetch" href="/assets/js/63.28bf9297.js"><link rel="prefetch" href="/assets/js/64.bb5de1f1.js"><link rel="prefetch" href="/assets/js/65.1808a334.js"><link rel="prefetch" href="/assets/js/66.4cf634a4.js"><link rel="prefetch" href="/assets/js/67.81fe6a7a.js"><link rel="prefetch" href="/assets/js/68.ca517c02.js"><link rel="prefetch" href="/assets/js/69.7c2f632d.js"><link rel="prefetch" href="/assets/js/7.16e12fce.js"><link rel="prefetch" href="/assets/js/70.49487463.js"><link rel="prefetch" href="/assets/js/71.b6ed3d37.js"><link rel="prefetch" href="/assets/js/72.310aeb7a.js"><link rel="prefetch" href="/assets/js/73.08ceed48.js"><link rel="prefetch" href="/assets/js/74.7c0ec651.js"><link rel="prefetch" href="/assets/js/75.53dd0345.js"><link rel="prefetch" href="/assets/js/76.ba69a169.js"><link rel="prefetch" href="/assets/js/77.1005ccf0.js"><link rel="prefetch" href="/assets/js/78.c5ce49d1.js"><link rel="prefetch" href="/assets/js/79.38623f00.js"><link rel="prefetch" href="/assets/js/8.b17d0b27.js"><link rel="prefetch" href="/assets/js/80.3b1cbc53.js"><link rel="prefetch" href="/assets/js/81.b1abda22.js"><link rel="prefetch" href="/assets/js/82.5b4fe850.js"><link rel="prefetch" href="/assets/js/83.49a41645.js"><link rel="prefetch" href="/assets/js/84.cbc74ebf.js"><link rel="prefetch" href="/assets/js/85.fdc4ea6a.js"><link rel="prefetch" href="/assets/js/86.1d269280.js"><link rel="prefetch" href="/assets/js/87.e66f5b10.js"><link rel="prefetch" href="/assets/js/88.6d74e710.js"><link rel="prefetch" href="/assets/js/89.e3a42899.js"><link rel="prefetch" href="/assets/js/9.0874a43d.js"><link rel="prefetch" href="/assets/js/90.3708c96d.js"><link rel="prefetch" href="/assets/js/91.a9abb019.js"><link rel="prefetch" href="/assets/js/92.c254d042.js"><link rel="prefetch" href="/assets/js/93.4cb5cd34.js"><link rel="prefetch" href="/assets/js/94.63f29f7c.js"><link rel="prefetch" href="/assets/js/95.d9da82dd.js"><link rel="prefetch" href="/assets/js/96.96cb53bb.js"><link rel="prefetch" href="/assets/js/97.139fd6fc.js"><link rel="prefetch" href="/assets/js/98.4c606050.js"><link rel="prefetch" href="/assets/js/99.93b7c1f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5f9f895.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar shadow"><div class="con-btns-header"><a href="/" class="home-link router-link-active"><div class="con-logo"><!----> <span class="site-name">Fellow Travellers</span></div></a> <div class="links"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link" data-v-e7cf42d2>主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">三维</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-tech3d/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/language/Micro-frontend_Start.html" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/production/" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/codelab/Principle_of_Visualizatio_for_WebGL.html" class="nav-link" data-v-e7cf42d2>专题</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/SuperMap_Questions_and_Answer.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-frontend/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/base/EC_ScopChain_Closure.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/web-gis/" class="nav-link" data-v-e7cf42d2>WebGIS开发</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/solution/" class="nav-link router-link-active" data-v-e7cf42d2>解决方案</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/best-practice/" class="nav-link" data-v-e7cf42d2>最佳实践</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/arithmetic/QuickSort.html" class="nav-link" data-v-e7cf42d2>算法</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">移动</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-mobile/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/dataResource/sourceCodeLib.html" class="nav-link" data-v-e7cf42d2>数据资源</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/product/nativeApp.html" class="nav-link" data-v-e7cf42d2>产品分型</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/appStore/" class="nav-link" data-v-e7cf42d2>应用商店</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/other/designDocument.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-calc3d/start/XinShouShouCe.html" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/gis/Base_ZBX_ZongJie.html" class="nav-link" data-v-e7cf42d2>GIS</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/database/Oracle_LostSysPassword.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/language/" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/codelab/" class="nav-link" data-v-e7cf42d2>源码库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/production/DDP_ArcGIS_BuShuShouCe.html" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-backend/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/database/Mongoazyx.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/framework/Git.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/production/" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><a href="/doc-share/SuperMap_Pipe3DStrategy.html" class="nav-link" data-v-e7cf42d2>分享</a></div><div class="nav-item"><a href="https://fellowtravellers.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link" data-v-e7cf42d2>社区</a></div><div class="nav-item"><a href="/doc-help/mdRule.html" class="nav-link" data-v-e7cf42d2>帮助</a></div></nav></div></div> <div class="con-redes-download"><a title="GitLab" href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/" target="_blank" rel="noopener noreferrer" class="repo-link flaticon-github"></a></div></header> <div class="sidebar-map"><div class="c-sidebar-map"><ul class="sidebar-links-map"><li><!----></li><li><!----></li><li><!----></li></ul> </div></div> <div class="sidebar"><div class="c-sidebar"> <div class="search-box"><input aria-label="Search" placeholder="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <ul class="sidebar-links"><li><a href="/doc-frontend/solution/" aria-current="page" class="sidebar-link">解决方案</a></li><li><a href="/doc-frontend/solution/ImageLoad.html" aria-current="page" class="active sidebar-link">图片加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-frontend/solution/ImageLoad.html#_1-应用场景" class="sidebar-link">1. 应用场景</a></li><li class="sidebar-sub-header"><a href="/doc-frontend/solution/ImageLoad.html#_2-功能关键点" class="sidebar-link">2. 功能关键点</a></li><li class="sidebar-sub-header"><a href="/doc-frontend/solution/ImageLoad.html#_3-实现流程" class="sidebar-link">3. 实现流程</a></li></ul></li><li><a href="/doc-frontend/solution/Cookie_SameSite.html" class="sidebar-link">Cookie 中的 SameSite 设置</a></li></ul> </div></div> <!----> <!----> <div class="page"><div class="content-pagex content content__default"><h1 id="图片加载"><a href="#图片加载" class="header-anchor">#</a> 图片加载</h1> <blockquote><p>作者: 魏聪 时间: 2021-01-13</p></blockquote> <h2 id="_1-应用场景"><a href="#_1-应用场景" class="header-anchor">#</a> 1. 应用场景</h2> <p>  图片加载的需求是这样的：本地加载一张图片，图片叠加到地图，调整图片大小和透明度，使图片内容和地图相关内容贴合，并且在地图缩放图片和地图始终贴合，这样用户可以直观看到图片内容和地图实际的对比情况。</p> <p><img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/f738f245aeed40848b8bcbb0741734ce/20210114134957.png" alt=""></p> <h2 id="_2-功能关键点"><a href="#_2-功能关键点" class="header-anchor">#</a> 2. 功能关键点</h2> <ul><li>图片本地加载</li> <li>图片调整</li> <li>图片始终贴合地图</li></ul> <h2 id="_3-实现流程"><a href="#_3-实现流程" class="header-anchor">#</a> 3. 实现流程</h2> <h3 id="_3-1-图片本地加载"><a href="#_3-1-图片本地加载" class="header-anchor">#</a> 3.1 图片本地加载</h3> <ul><li><p>提到文件本地加载，我们马上就想到了<code>&lt;input type=”file”&gt;</code>或者拖拽上传方式，显然这次我们使用<code>&lt;input type=”file”&gt;</code>就好了，通过文件接口我们就可以获取图片文件 File 对象了，它是继承至 Blob 对象的，我们以前获取到 File 对象或者 FileList 都是直接上传到后台的，后台在返回给我们结果，那么我们怎么在本地把 File 对象里面数据直接加载到 DOM 中呢？JS 中提供了一个操作 File 和 Blob 对象的 FileReader 类，我们可以使用这个类来异步读取文件，它有四个实用方法：
<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/5c69071f1e6810d0beb87b1fa45dc570/20210114135302.png" alt="">
我们可以调用不同函数，从而将 Blob 类型数据或者 File 类型数据转为我们所需类型。我们这次直接转为 Base64 就好了，这样我们就获取到了图片数据。</p></li> <li><p>获取图片数据之后，我们需要将图片数据加载到网页中，但是图片现在没有一个确定的宽高和坐标，所以我们需要创建一个 Image 对象，它将图片数据转为一个图片对象，通过 Image. naturalWidth 和 Image. naturalHeight 拿到图片的原始大小（图片原始大小可能过大，我在配置文件里面设置一个图片初始缩放比例，同时配置了一个初始图片经纬度坐标），通过 mapView.toScreen 就可以拿到图片的屏幕坐标了。这样可以确定图片在页面上的位置和大小了。</p> <blockquote><p>注意：通过 toScreen 拿到的不是真的意义上的屏幕点，它的屏幕坐标是相对地图容器的左上角。</p></blockquote> <p><img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/d891f29c4b1d0c83940607e80a29dece/20210114135420.png" alt=""></p></li> <li><p>确定图片位置信息之后，我们就可以构建 DOM 结构：外层绝对定位覆盖整个地图，为了不影响地图操作，暂时去除了它的所有事件操作（pointEvents:none）,图片外面又包裹了一个容器，它的宽高靠图片进行撑开，它主要作用是容纳几个图片拖拽柄(绝对定位进行定位)，另外 display 设置为 inline-block，防止宽度溢出，并且添加事件操作（pointEvents:all）。最后创建一个 img 节点，将图片对象的数据赋予它就好了。这样图片的本地加载就完成了。
<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/b23a99a5f4585fbda52bccde9e102f6e/20210114135525.png" alt=""></p></li></ul> <h3 id="_3-2-图片调整"><a href="#_3-2-图片调整" class="header-anchor">#</a> 3.2 图片调整</h3> <p>   上面我们将 DOM 结构构建好了，现在就是添加事件了，图片调整主要是图片大小调整和位置调整。</p> <ul><li><ol><li>位置调整 位置调整的思路主要是这样的：</li></ol> <ul><li>图片绑定 mousedown 事件</li> <li><ul><li>在 mousedown 事件回调中给最外围容器绑定 mousemove 和 mouseup 事件，此时并保存鼠标的位置信息。</li></ul></li> <li><ul><li>在 mousemove 事件计算鼠标偏移量，重设设置图片容器的 top 和 left 值。</li></ul></li> <li><ul><li>在 mouseup 事件中移除 mousemove 事件和 mouseup 事件</li></ul></li> <li>鼠标偏移公式：</li> <li><ul><li>top: y - this.$subInfo.mousey + this.$subInfo.top + &quot;px&quot;</li></ul></li> <li><ul><li>left: x - this.$subInfo.mousex + this.$subInfo.left + &quot;px&quot;</li></ul></li> <li><ul><li>鼠标偏移量+原来 top，left 值，原本想直接 e.movementX 和 e.movementY，但是发现非常卡，暂时没有找到原因，可能触发频率太快，每次 e.movementX 和 e.movementY 增值都很小。</li></ul></li></ul></li> <li><ol start="2"><li>大小调整
大小调整的思路主要是这样的：</li></ol> <ul><li><ul><li>每个拖拽柄绑定 mousedown 事件，每个拖拽柄通过不同类来标识自己。</li></ul></li> <li><ul><li>在 mousedown 事件回调中，添加最外部容器事件操作（pointEvent:all），并为它绑定 mousemove 和 mouseup 事件，此时保存图片容器的属性信息和此时的拖拽柄节点。</li></ul></li> <li><ul><li>在 mousemove 事件中，根据类判断拖拽柄，然后计算鼠标偏移信息，重新计算拖拽柄位置，重设图片容器的 top 和 left 值，并且计算出此时的图片的 width 和 height，重新生成图片。<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/a7a6101e1f2545af159324699f966049/20210114135859.png" alt=""></li></ul></li> <li><ul><li>在 mouseup 事件中，移除 mousemove 事件和 mouseup 事件，并移除最外部容器的所有事件响应（pointEvents:none）</li></ul></li> <li>位置计算公式(左上角拖拽柄)：<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/7a21b8476633d2568fd9452a5a68cf22/20210114135955.png" alt=""> <blockquote><p>注意：此时鼠标位置 clientX 和 clientY 需要减去地图容器的相对页面的偏移值。<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/36a1b652a97fe8e11c7bc1250e543e44/20210114140059.png" alt="">大框减小框就是此时图片 width 和 height，鼠标当前位置就是 top 和 left:<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/6fff07395aa12b822394ae87f7b52f79/20210114140140.png" alt=""></p></blockquote></li></ul></li> <li><ol start="3"><li>边界控制
我看了下，感觉没有做边界的必要，所以这一步省略。主要在 mousemove 事件中控制一下鼠标范围就好了。</li></ol></li></ul> <h3 id="_3-3-图片始终贴合地图"><a href="#_3-3-图片始终贴合地图" class="header-anchor">#</a> 3.3 图片始终贴合地图</h3> <p>   图片需要始终贴合地图的话，我们首先想到需要给图片添加一个坐标系，那么怎么添加坐标系呢，那就属于图片配准的事了，这个就需要计算来进行了。</p> <ul><li>1、大致思路
前端通过上传图片信息到计算，计算通过图片配准来给图片添加坐标系，放置图片到工作空间目录下，前端构建一个动态服务，并且添加一个动态服务子图层来请求工作空间下的有坐标系图片，然后添加动态服务到地图中。</li> <li>2、前期准备
一个空的动态服务，创建一个工作空间，并且工作空间绑定一个路径（生成图片将放置在这个路径下面），然后将工作空间和动态服务进行绑定。<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/e7ca93fb99e62710ca10e22985d14429/20210114140411.png" alt=""></li> <li>3、前端逻辑
获取调整好的图片四个角坐标，转成经纬度，将其和图片文件一并通过接口传给计算：<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/876d2edaa2ce3ca52f0a591c758ba53e/20210114140450.png" alt="">接口响应成功后，计算返回工作空间下图片文件的名称，之后前端进行动态服务的创建，并为动态服务添加一个子图层，类型是 data-layer，这里有两种类型的子图层：map-layer 和 data-layer，类型是 map-layer 的允许你使用新的 renderers, definition expressions, opacity, scale visibility 来覆盖原来动态服务中的子图层样式，类型是 data-layer 的允许你创建一个子图层，但是图层数据可以来自注册的工作空间。它提供一个 dataSource 配置，提供了不同类型的数据源类型：
TableDataSource、QueryTableDataSource、RasterDataSource、JoinTableDataSource，
有表类型的，像 geodatabase，有栅格类型的，像各种格式图片。
我们只需要提供工作空间 ID 和对应表名和栅格文件名，就可以给子图层注册服务端数据了。<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/2c9db27d54ded1a13ca8b79af61b826f/20210114140522.png" alt="">每次缩放时，会请求一张新的图片，这样我们就将服务端的有坐标信息的栅格图片数据加载到地图了。</li> <li>4、计算逻辑
计算先进行绑定之前建立的栅格工作空间，等待前端上传图片和图片信息之后，获取参数计算获取图片左上角，右下角两个点坐标，图片高度，宽度等参数，并且根据参数 width 和 height 调整图片大小，并转换成 PNG 格式（前端可能上传 JPG 或者 PNG 格式的图片，但是最终生成的需要是 PNG 格式，因为 JPG 是不支持透明的，所以需要对 JPG 格式的图片进行格式转换），然后根据图片的左上角，右下角两个坐标，利用 AE 接口对栅格图片进行地理配准，经过地理配准之后，图片就带有了坐标信息，在我们请求图片的时候，就可以加载到对应坐标系的坐标位置上了，最后计算返回工作空间绑定目录下的图片名称给前端，至此计算完成响应。</li></ul></div> <div class="content edit-link"><a href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/edit/master/docs/doc-frontend/solution/ImageLoad.md" target="_blank" rel="noopener noreferrer">
      编辑此页面
    </a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="content page-nav"><p class="inner"><span class="prev"><a href="/doc-frontend/solution/" class="prev router-link-active">&lt; 解决方案</a></span> <span class="next"><a href="/doc-frontend/solution/Cookie_SameSite.html">
          Cookie 中的 SameSite 设置
          &gt;
        </a></span></p></div> <div class="footer">数据中心 研发二部</div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.24ab3d2f.js" defer></script><script src="/assets/js/3.ae223e66.js" defer></script><script src="/assets/js/1.02cf7ae9.js" defer></script><script src="/assets/js/136.34155571.js" defer></script>
  </body>
</html>
