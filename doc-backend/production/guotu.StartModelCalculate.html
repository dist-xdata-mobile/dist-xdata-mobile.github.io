<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>启动模型计算 | Fellow Travellers</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <meta name="description" content="Fellow-Travellers documents for tech3D / mobile / calc / back-end">
    <link rel="preload" href="/assets/css/0.styles.e5f9f895.css" as="style"><link rel="preload" href="/assets/js/app.24ab3d2f.js" as="script"><link rel="preload" href="/assets/js/3.ae223e66.js" as="script"><link rel="preload" href="/assets/js/1.02cf7ae9.js" as="script"><link rel="preload" href="/assets/js/49.4a0ef904.js" as="script"><link rel="prefetch" href="/assets/js/10.e7275784.js"><link rel="prefetch" href="/assets/js/100.d9491c22.js"><link rel="prefetch" href="/assets/js/101.b597c13c.js"><link rel="prefetch" href="/assets/js/102.4c7459a2.js"><link rel="prefetch" href="/assets/js/103.1c9747dd.js"><link rel="prefetch" href="/assets/js/104.c71d56dc.js"><link rel="prefetch" href="/assets/js/105.260aaf9f.js"><link rel="prefetch" href="/assets/js/106.c972e851.js"><link rel="prefetch" href="/assets/js/107.e2376f77.js"><link rel="prefetch" href="/assets/js/108.32a64a11.js"><link rel="prefetch" href="/assets/js/109.719f01a0.js"><link rel="prefetch" href="/assets/js/11.4c9b4d46.js"><link rel="prefetch" href="/assets/js/110.098b415a.js"><link rel="prefetch" href="/assets/js/111.d58749eb.js"><link rel="prefetch" href="/assets/js/112.b4bd956b.js"><link rel="prefetch" href="/assets/js/113.aa2bed70.js"><link rel="prefetch" href="/assets/js/114.68eddcfa.js"><link rel="prefetch" href="/assets/js/115.07baa390.js"><link rel="prefetch" href="/assets/js/116.be414d7b.js"><link rel="prefetch" href="/assets/js/117.d0d1a156.js"><link rel="prefetch" href="/assets/js/118.0f217bd0.js"><link rel="prefetch" href="/assets/js/119.ed7e911b.js"><link rel="prefetch" href="/assets/js/12.77e0d4e1.js"><link rel="prefetch" href="/assets/js/120.4268db58.js"><link rel="prefetch" href="/assets/js/121.a1fabb59.js"><link rel="prefetch" href="/assets/js/122.a8f8afb8.js"><link rel="prefetch" href="/assets/js/123.cd0337d5.js"><link rel="prefetch" href="/assets/js/124.53f839b5.js"><link rel="prefetch" href="/assets/js/125.29087754.js"><link rel="prefetch" href="/assets/js/126.73b06641.js"><link rel="prefetch" href="/assets/js/127.c15df3e7.js"><link rel="prefetch" href="/assets/js/128.4b622d18.js"><link rel="prefetch" href="/assets/js/129.eec23a90.js"><link rel="prefetch" href="/assets/js/13.faee7a70.js"><link rel="prefetch" href="/assets/js/130.1af66f4a.js"><link rel="prefetch" href="/assets/js/131.6696c658.js"><link rel="prefetch" href="/assets/js/132.3fbfe61b.js"><link rel="prefetch" href="/assets/js/133.2a98d40b.js"><link rel="prefetch" href="/assets/js/134.8ef5d3a3.js"><link rel="prefetch" href="/assets/js/135.753932d8.js"><link rel="prefetch" href="/assets/js/136.34155571.js"><link rel="prefetch" href="/assets/js/137.d1b34ead.js"><link rel="prefetch" href="/assets/js/138.45212dde.js"><link rel="prefetch" href="/assets/js/139.1c99686e.js"><link rel="prefetch" href="/assets/js/14.5e1b322f.js"><link rel="prefetch" href="/assets/js/140.62fd886e.js"><link rel="prefetch" href="/assets/js/141.590373f9.js"><link rel="prefetch" href="/assets/js/142.12c5641d.js"><link rel="prefetch" href="/assets/js/143.161a15ca.js"><link rel="prefetch" href="/assets/js/144.c79ba202.js"><link rel="prefetch" href="/assets/js/145.713910f8.js"><link rel="prefetch" href="/assets/js/146.fe23e26a.js"><link rel="prefetch" href="/assets/js/147.ca8f3b04.js"><link rel="prefetch" href="/assets/js/148.de0f7a57.js"><link rel="prefetch" href="/assets/js/149.e4034326.js"><link rel="prefetch" href="/assets/js/15.c64a0296.js"><link rel="prefetch" href="/assets/js/150.3bb80c41.js"><link rel="prefetch" href="/assets/js/151.59f060b6.js"><link rel="prefetch" href="/assets/js/152.0272a857.js"><link rel="prefetch" href="/assets/js/153.bc2da934.js"><link rel="prefetch" href="/assets/js/154.89ec0012.js"><link rel="prefetch" href="/assets/js/155.88c7ce2d.js"><link rel="prefetch" href="/assets/js/156.65bc67ce.js"><link rel="prefetch" href="/assets/js/157.9ce1e89f.js"><link rel="prefetch" href="/assets/js/158.9b5a7a8d.js"><link rel="prefetch" href="/assets/js/159.d3aeb115.js"><link rel="prefetch" href="/assets/js/16.f13c1a4b.js"><link rel="prefetch" href="/assets/js/160.262cdd64.js"><link rel="prefetch" href="/assets/js/161.9a6c7442.js"><link rel="prefetch" href="/assets/js/162.17602366.js"><link rel="prefetch" href="/assets/js/163.95960581.js"><link rel="prefetch" href="/assets/js/164.dab8d2fe.js"><link rel="prefetch" href="/assets/js/165.b6a6ebc3.js"><link rel="prefetch" href="/assets/js/166.e79f3098.js"><link rel="prefetch" href="/assets/js/167.1efeaca8.js"><link rel="prefetch" href="/assets/js/168.a02e5d8f.js"><link rel="prefetch" href="/assets/js/169.ae4e6391.js"><link rel="prefetch" href="/assets/js/17.e99ac461.js"><link rel="prefetch" href="/assets/js/170.c816925e.js"><link rel="prefetch" href="/assets/js/171.f26a925a.js"><link rel="prefetch" href="/assets/js/172.8343d102.js"><link rel="prefetch" href="/assets/js/173.7fa1ebef.js"><link rel="prefetch" href="/assets/js/174.20760d4a.js"><link rel="prefetch" href="/assets/js/175.30d21385.js"><link rel="prefetch" href="/assets/js/176.7e010e6e.js"><link rel="prefetch" href="/assets/js/177.516d6c9b.js"><link rel="prefetch" href="/assets/js/178.fa15b667.js"><link rel="prefetch" href="/assets/js/179.77b21239.js"><link rel="prefetch" href="/assets/js/18.2df0d7da.js"><link rel="prefetch" href="/assets/js/180.7af949ed.js"><link rel="prefetch" href="/assets/js/181.0ca97274.js"><link rel="prefetch" href="/assets/js/182.5d69cb31.js"><link rel="prefetch" href="/assets/js/183.6b437eec.js"><link rel="prefetch" href="/assets/js/184.9ab2be09.js"><link rel="prefetch" href="/assets/js/185.6713b8ec.js"><link rel="prefetch" href="/assets/js/186.9b592f14.js"><link rel="prefetch" href="/assets/js/187.3c51d982.js"><link rel="prefetch" href="/assets/js/188.1b8199d6.js"><link rel="prefetch" href="/assets/js/189.f1057605.js"><link rel="prefetch" href="/assets/js/19.74c2fe85.js"><link rel="prefetch" href="/assets/js/190.36072c89.js"><link rel="prefetch" href="/assets/js/191.499d698f.js"><link rel="prefetch" href="/assets/js/192.263a4d10.js"><link rel="prefetch" href="/assets/js/193.8fc88b41.js"><link rel="prefetch" href="/assets/js/194.406ef82d.js"><link rel="prefetch" href="/assets/js/195.8c94f51b.js"><link rel="prefetch" href="/assets/js/196.02df8beb.js"><link rel="prefetch" href="/assets/js/197.6b4b0107.js"><link rel="prefetch" href="/assets/js/198.5ceb1715.js"><link rel="prefetch" href="/assets/js/20.37ef7b5a.js"><link rel="prefetch" href="/assets/js/21.8edf360c.js"><link rel="prefetch" href="/assets/js/22.681f9ff8.js"><link rel="prefetch" href="/assets/js/23.6355d98a.js"><link rel="prefetch" href="/assets/js/24.0d068097.js"><link rel="prefetch" href="/assets/js/25.b8c6fba0.js"><link rel="prefetch" href="/assets/js/26.b76fcccf.js"><link rel="prefetch" href="/assets/js/27.b95d8356.js"><link rel="prefetch" href="/assets/js/28.37a344fe.js"><link rel="prefetch" href="/assets/js/29.717a72c0.js"><link rel="prefetch" href="/assets/js/30.55087dce.js"><link rel="prefetch" href="/assets/js/31.c151abfb.js"><link rel="prefetch" href="/assets/js/32.7a8f6337.js"><link rel="prefetch" href="/assets/js/33.ac183ed2.js"><link rel="prefetch" href="/assets/js/34.7d1e8694.js"><link rel="prefetch" href="/assets/js/35.a28b2867.js"><link rel="prefetch" href="/assets/js/36.e4b030f9.js"><link rel="prefetch" href="/assets/js/37.d2c79d7a.js"><link rel="prefetch" href="/assets/js/38.e9f9734a.js"><link rel="prefetch" href="/assets/js/39.41d4212f.js"><link rel="prefetch" href="/assets/js/4.09ef6149.js"><link rel="prefetch" href="/assets/js/40.4e231720.js"><link rel="prefetch" href="/assets/js/41.78793a6d.js"><link rel="prefetch" href="/assets/js/42.9e9728c2.js"><link rel="prefetch" href="/assets/js/43.806dbed8.js"><link rel="prefetch" href="/assets/js/44.f5808021.js"><link rel="prefetch" href="/assets/js/45.cd3b9402.js"><link rel="prefetch" href="/assets/js/46.f597a77f.js"><link rel="prefetch" href="/assets/js/47.42c52267.js"><link rel="prefetch" href="/assets/js/48.7a5795b7.js"><link rel="prefetch" href="/assets/js/5.9ee91412.js"><link rel="prefetch" href="/assets/js/50.b089522d.js"><link rel="prefetch" href="/assets/js/51.cd200a2d.js"><link rel="prefetch" href="/assets/js/52.ddb691c6.js"><link rel="prefetch" href="/assets/js/53.9e959307.js"><link rel="prefetch" href="/assets/js/54.ebdd0492.js"><link rel="prefetch" href="/assets/js/55.3dbd94ea.js"><link rel="prefetch" href="/assets/js/56.d39f7dbe.js"><link rel="prefetch" href="/assets/js/57.6f1c287b.js"><link rel="prefetch" href="/assets/js/58.13e00c1a.js"><link rel="prefetch" href="/assets/js/59.69e8bd65.js"><link rel="prefetch" href="/assets/js/6.4c4772aa.js"><link rel="prefetch" href="/assets/js/60.fbdc4a90.js"><link rel="prefetch" href="/assets/js/61.d7cc6838.js"><link rel="prefetch" href="/assets/js/62.b6672e01.js"><link rel="prefetch" href="/assets/js/63.28bf9297.js"><link rel="prefetch" href="/assets/js/64.bb5de1f1.js"><link rel="prefetch" href="/assets/js/65.1808a334.js"><link rel="prefetch" href="/assets/js/66.4cf634a4.js"><link rel="prefetch" href="/assets/js/67.81fe6a7a.js"><link rel="prefetch" href="/assets/js/68.ca517c02.js"><link rel="prefetch" href="/assets/js/69.7c2f632d.js"><link rel="prefetch" href="/assets/js/7.16e12fce.js"><link rel="prefetch" href="/assets/js/70.49487463.js"><link rel="prefetch" href="/assets/js/71.b6ed3d37.js"><link rel="prefetch" href="/assets/js/72.310aeb7a.js"><link rel="prefetch" href="/assets/js/73.08ceed48.js"><link rel="prefetch" href="/assets/js/74.7c0ec651.js"><link rel="prefetch" href="/assets/js/75.53dd0345.js"><link rel="prefetch" href="/assets/js/76.ba69a169.js"><link rel="prefetch" href="/assets/js/77.1005ccf0.js"><link rel="prefetch" href="/assets/js/78.c5ce49d1.js"><link rel="prefetch" href="/assets/js/79.38623f00.js"><link rel="prefetch" href="/assets/js/8.b17d0b27.js"><link rel="prefetch" href="/assets/js/80.3b1cbc53.js"><link rel="prefetch" href="/assets/js/81.b1abda22.js"><link rel="prefetch" href="/assets/js/82.5b4fe850.js"><link rel="prefetch" href="/assets/js/83.49a41645.js"><link rel="prefetch" href="/assets/js/84.cbc74ebf.js"><link rel="prefetch" href="/assets/js/85.fdc4ea6a.js"><link rel="prefetch" href="/assets/js/86.1d269280.js"><link rel="prefetch" href="/assets/js/87.e66f5b10.js"><link rel="prefetch" href="/assets/js/88.6d74e710.js"><link rel="prefetch" href="/assets/js/89.e3a42899.js"><link rel="prefetch" href="/assets/js/9.0874a43d.js"><link rel="prefetch" href="/assets/js/90.3708c96d.js"><link rel="prefetch" href="/assets/js/91.a9abb019.js"><link rel="prefetch" href="/assets/js/92.c254d042.js"><link rel="prefetch" href="/assets/js/93.4cb5cd34.js"><link rel="prefetch" href="/assets/js/94.63f29f7c.js"><link rel="prefetch" href="/assets/js/95.d9da82dd.js"><link rel="prefetch" href="/assets/js/96.96cb53bb.js"><link rel="prefetch" href="/assets/js/97.139fd6fc.js"><link rel="prefetch" href="/assets/js/98.4c606050.js"><link rel="prefetch" href="/assets/js/99.93b7c1f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5f9f895.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar shadow"><div class="con-btns-header"><a href="/" class="home-link router-link-active"><div class="con-logo"><!----> <span class="site-name">Fellow Travellers</span></div></a> <div class="links"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link" data-v-e7cf42d2>主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">三维</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-tech3d/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/language/Micro-frontend_Start.html" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/production/" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/codelab/Principle_of_Visualizatio_for_WebGL.html" class="nav-link" data-v-e7cf42d2>专题</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/SuperMap_Questions_and_Answer.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-frontend/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/base/EC_ScopChain_Closure.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/web-gis/" class="nav-link" data-v-e7cf42d2>WebGIS开发</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/solution/" class="nav-link" data-v-e7cf42d2>解决方案</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/best-practice/" class="nav-link" data-v-e7cf42d2>最佳实践</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/arithmetic/QuickSort.html" class="nav-link" data-v-e7cf42d2>算法</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">移动</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-mobile/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/dataResource/sourceCodeLib.html" class="nav-link" data-v-e7cf42d2>数据资源</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/product/nativeApp.html" class="nav-link" data-v-e7cf42d2>产品分型</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/appStore/" class="nav-link" data-v-e7cf42d2>应用商店</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/other/designDocument.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-calc3d/start/XinShouShouCe.html" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/gis/Base_ZBX_ZongJie.html" class="nav-link" data-v-e7cf42d2>GIS</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/database/Oracle_LostSysPassword.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/language/" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/codelab/" class="nav-link" data-v-e7cf42d2>源码库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/production/DDP_ArcGIS_BuShuShouCe.html" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-backend/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/database/Mongoazyx.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/framework/Git.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/production/" class="nav-link router-link-active" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><a href="/doc-share/SuperMap_Pipe3DStrategy.html" class="nav-link" data-v-e7cf42d2>分享</a></div><div class="nav-item"><a href="https://fellowtravellers.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link" data-v-e7cf42d2>社区</a></div><div class="nav-item"><a href="/doc-help/mdRule.html" class="nav-link" data-v-e7cf42d2>帮助</a></div></nav></div></div> <div class="con-redes-download"><a title="GitLab" href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/" target="_blank" rel="noopener noreferrer" class="repo-link flaticon-github"></a></div></header> <div class="sidebar-map"><div class="c-sidebar-map"><ul class="sidebar-links-map"><li><div class="sidebar-group first"><ul class="sidebar-group-items"><li><a href="/doc-backend/production/" aria-current="page" class="sidebar-link siderbar-map-item">简介</a></li><li><a href="/doc-backend/production/guotu.StartModelCalculate.html" aria-current="page" class="active sidebar-link siderbar-map-item">启动模型计算</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/doc-backend/production/guotu.AuxiliaryReviewSystem.html" class="sidebar-link siderbar-map-item">辅助审查系统</a></li><li><a href="/doc-backend/production/guotu.MonitoringWaringSystem.html" class="sidebar-link siderbar-map-item">监测预警系统</a></li><li><a href="/doc-backend/production/ghfxpj.html" class="sidebar-link siderbar-map-item">规划分析评价</a></li><li><a href="/doc-backend/production/jcpgyj2.html" class="sidebar-link siderbar-map-item">监测预警解析 2</a></li></ul></div></li><li><div class="sidebar-group"><ul class="sidebar-group-items"><li><a href="/doc-backend/production/jcxxpt&amp;lcbd.html" class="sidebar-link siderbar-map-item">基础信息平台 &amp; 流程表单简介</a></li></ul></div></li></ul> </div></div> <div class="sidebar"><div class="c-sidebar"> <div class="search-box"><input aria-label="Search" placeholder="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>国土产品</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc-backend/production/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/doc-backend/production/guotu.StartModelCalculate.html" aria-current="page" class="active sidebar-link">启动模型计算</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/doc-backend/production/guotu.AuxiliaryReviewSystem.html" class="sidebar-link">辅助审查系统</a></li><li><a href="/doc-backend/production/guotu.MonitoringWaringSystem.html" class="sidebar-link">监测预警系统</a></li><li><a href="/doc-backend/production/ghfxpj.html" class="sidebar-link">规划分析评价</a></li><li><a href="/doc-backend/production/jcpgyj2.html" class="sidebar-link">监测预警解析 2</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>基础信息平台</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc-backend/production/jcxxpt&amp;lcbd.html" class="sidebar-link">基础信息平台 &amp; 流程表单简介</a></li></ul></div></li></ul> </div></div> <!----> <!----> <div class="page"><div class="content-pagex content content__default"><h1 id="启动模型计算"><a href="#启动模型计算" class="header-anchor">#</a> 启动模型计算</h1> <blockquote><p>作者：于佳鑫</p></blockquote> <p>因为这个地方比较复杂而且涉及到的地方比较多，所以单独独立成一篇文章来介绍，下面先看一下这部分的流程图。</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/a3a6695dccdab64dd1641d7223fc9fd9/图片2.png" alt="图片2" style="zoom:63%;"> <p>启动模型计算这一部分在后台主要做了两件事：1. 调用模型对用户上传的数据进行计算 2. 调用自动发服务模块将用户上传的 gdb 文件发布成服务。</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/22c7a1d04e9fc8909a27153b94ac5f3a/image-20200918135523067.png" alt="image-20200918135523067" style="zoom:50%;"> <h3 id="_1-1-自动发服务"><a href="#_1-1-自动发服务" class="header-anchor">#</a> 1.1 自动发服务</h3> <p><strong>此部分涉及到的表：</strong></p> <p>MapServerLog（存放发布服务时的日志）</p> <blockquote><p>注：只列出部分重要的字段。</p></blockquote> <table><thead><tr><th>字段名</th> <th>描述</th> <th>备注</th></tr></thead> <tbody><tr><td>reviewTaskId</td> <td>审查任务 id</td> <td></td></tr> <tr><td>sourceFileId</td> <td>发布服务的数据源文件 id（ResourceFile 表）</td> <td>这个就是矢量数据下的那个 gdb 文件的 id</td></tr> <tr><td>publishStatus</td> <td>发布状态</td> <td>0 -&gt; 以发布，未检测，此时前端会提示“服务正在发布中，请等待！”</td></tr> <tr><td></td> <td></td> <td>1 -&gt; 已检测，发布成功</td></tr> <tr><td></td> <td></td> <td>2 -&gt; 已检测，发布失败，此时前端会提示“是否重新发服务”</td></tr> <tr><td>serviceName</td> <td>服务名称</td> <td>前端最终通过这个拼接出地址调用发布出来的服务</td></tr></tbody></table> <p><strong>代码逻辑：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MapPublishServiceImpl</span><span class="token punctuation">.</span>java

<span class="token comment">/**
 * 发布地图服务
 */</span>
<span class="token annotation punctuation">@Async</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publishMapService</span><span class="token punctuation">(</span><span class="token class-name">Long</span> reviewTaskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果之前已经发布过服务，则清楚之前发布的痕迹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanUpMapServiceData</span><span class="token punctuation">(</span>reviewTaskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 发布服务，此时会记录日志，publishStatus 的值为 0</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>reviewTaskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 检查服务发布状态（死循环），如果成功将 publishStatus 的值改为 1，失败将 publishStatus 的值改为 2</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkPublishStatus</span><span class="token punctuation">(</span>reviewTaskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_1-2-启动模型计算"><a href="#_1-2-启动模型计算" class="header-anchor">#</a> 1.2 启动模型计算</h3> <p><strong>涉及到的表：</strong></p> <p>ModelCalcDatasourceLog（存放模型计算的数据源信息）</p> <table><thead><tr><th>字段名</th> <th>描述</th> <th>备注</th></tr></thead> <tbody><tr><td>reviewTaskId</td> <td>审查任务 id</td> <td>一个审查任务的成果包中可能有多个数据源</td></tr> <tr><td>sysCode</td> <td>数据源 code</td> <td>调用模型上传数据源，模型返回的唯一标识</td></tr> <tr><td>datasourceType</td> <td>数据源类型</td> <td>标识着数据源在成果包的哪个位置</td></tr></tbody></table> <p>ModelCalcLog（模型计算任务日志）</p> <table><thead><tr><th>字段名</th> <th>描述</th> <th>备注</th></tr></thead> <tbody><tr><td>reviewTaskId</td> <td>审查任务 id</td> <td></td></tr> <tr><td>taskInstanceId</td> <td>任务实例 code</td> <td>模型计算任务的唯一标识</td></tr> <tr><td>reviewPointId</td> <td>审查要点 id</td> <td></td></tr> <tr><td>calcStatus</td> <td>模型计算状态</td> <td>0 -&gt; 计算中</td></tr> <tr><td></td> <td></td> <td>1 -&gt; 计算成功</td></tr> <tr><td></td> <td></td> <td>2 -&gt; 计算失败</td></tr> <tr><td></td> <td></td> <td>3 -&gt; 未计算，出现的原因：在数据库中配置了这个模型参与计算，但是却没有给他配置计算任务（ModelCalcTask）<img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/92dbc308c401070506c240a95ff0e883/image-20200918160209256.png" alt="image-20200918160209256" style="zoom:25%;"></td></tr></tbody></table> <p>ModelCalculationResult（存放模型计算结果，纵表）</p> <table><thead><tr><th>字段名</th> <th>描述</th> <th>备注</th></tr></thead> <tbody><tr><td>reviewTaskId</td> <td>审查任务 id</td> <td></td></tr> <tr><td>reviewPointId</td> <td>审查要点 id</td> <td></td></tr> <tr><td>key</td> <td>属性名</td> <td></td></tr> <tr><td>value</td> <td>属性值</td> <td></td></tr> <tr><td>position</td> <td>代表是哪一行的数据</td> <td></td></tr></tbody></table> <p>ModelConflictServer（模型计算的差异服务）</p> <table><thead><tr><th>字段名</th> <th>描述</th> <th>备注</th></tr></thead> <tbody><tr><td>reviewTaskId</td> <td>审查任务 id</td> <td></td></tr> <tr><td>reviewPointId</td> <td>审查要点 id</td> <td></td></tr> <tr><td>serverName</td> <td>服务名</td> <td></td></tr> <tr><td>layerName</td> <td>图层名</td> <td></td></tr></tbody></table> <p><strong>类名的含义</strong>：</p> <table><thead><tr><th>类名</th> <th>含义</th></tr></thead> <tbody><tr><td>DownloadDatasourceFile</td> <td>负责寻找到数据源并且下载</td></tr> <tr><td>AcquireTaskInstanceFunctional</td> <td>负责封装不同模型的请求参数</td></tr> <tr><td>DisposeCalcResultFunctional</td> <td>负责解析不同模型返回的参数</td></tr> <tr><td>ModelCalcTask</td> <td>其实它应该叫“模型计算算法”，其中封装了模型系统中每种算法的请求-解析流程。</td></tr></tbody></table> <p><strong>代码逻辑：</strong></p> <p>--------------- MmsCalcServiceImpl2</p> <ol><li>将审查任务的状态改为【计算中】</li> <li>调用 startTaskFaced#batchStartCalcTaskV2() 对模型任务进行计算</li></ol> <p>--------------- StartTaskFaced</p> <ol start="3"><li>获取所有计算规则对象，通过审查任务的 planType 和 areaLevel 查询出需要计算的审查要点，并将其与计算规则对象绑定起来。此时如果发现系统中没有配置审查要点对应的“计算规则”，那么将会记录日志 calcStatus = 3（未计算）。</li> <li>过滤出“计算规则”对象之后，获取“计算规则”对象所需的数据源，进行数据源的注册。</li> <li>启动所有模型的计算（合并发服务除外），调用 StartTaskTemplateMethod</li></ol> <p>--------------- StartTaskTemplateMethod（这个是模板方法，主要调用的是 ModelCalcTask 中的方法）</p> <ol start="6"><li>封装参数请求模型（AcquireTaskInstanceFunctional）获取模型任务的实例 code</li> <li>记录模型【正在运行中】的日志（ModelCalcLog 表）</li> <li>轮训的请求模型任务是否计算成功，成功继续往下走，失败则记录模型【计算失败】</li> <li>获取模型结果</li> <li>解析模型结果（DisposeCalcResultFunctional）成为我们系统需要的格式</li> <li>结果入库</li></ol> <p>--------------- StartTaskFaced</p> <ol start="12"><li>启动合并发服务模型的计算，调用 StartTaskTemplateMethod（同 6~11）</li></ol> <h4 id="合并发服务"><a href="#合并发服务" class="header-anchor">#</a> 合并发服务</h4> <p>有的空间性模型需要计算差异图斑，之前也是在 ModelCalculationResult 表中存储的，但是图斑数据量太大了，导致查询比较缓慢，所以新增了一个合并发服务的模型，将这些差异图斑发布成服务由前端调用。所以合并发服务需要在所有空间模型计算完成之后再计算。</p> <p>前端获取差异图层的接口为：/v2/reviewPoint/conflictServer/{reviewTaskId}/{reviewPointId}</p> <h4 id="前端调用"><a href="#前端调用" class="header-anchor">#</a> 前端调用</h4> <blockquote><p>注：看不懂的话先看常见问题 2</p></blockquote> <p>一个模型计算规则由 AcquireTaskInstanceFunctional 和 DisposeCalcResultFunctional 组成，其中解析方式（DisposeCalcResultFunctional）相同的模型计算结果返回给前端时封装的格式也相同，例如：</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/10b90d434bc4b487b728018725a833df/image-20200921142406784.png" alt="image-20200921142406784" style="zoom:50%;"> <p>这个计算规则配置的解析是 6，所以他对应的返回给前端的接口也就是 types6：</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/8eb75432258b2fe9bc58b217e816b896/image-20200921142544018.png" alt="image-20200921142544018" style="zoom:50%;"> <h3 id="_1-3-常见问题"><a href="#_1-3-常见问题" class="header-anchor">#</a> 1.3 常见问题</h3> <h4 id="_1）如何添加审查要点"><a href="#_1）如何添加审查要点" class="header-anchor">#</a> 1）如何添加审查要点</h4> <p>ReviewPoint 表</p> <table><thead><tr><th>字段名</th> <th>注释</th> <th>作用</th> <th>备注</th></tr></thead> <tbody><tr><td>id</td> <td>节点 id</td> <td></td> <td>系统自动生成</td></tr> <tr><td>reviewPointName</td> <td>审查要点名</td> <td></td> <td>与模型名一一对应</td></tr> <tr><td>doubleScreen</td> <td>是否双屏</td> <td>控制前端页面双屏展示</td> <td></td></tr> <tr><td>parentId</td> <td><strong>父节点 id</strong></td> <td>维持树形结构</td> <td></td></tr> <tr><td>leafNode</td> <td><strong>是否叶子节点</strong></td> <td>审查要点树叶子节点</td> <td></td></tr> <tr><td>display</td> <td><strong>是否显示</strong></td> <td><strong>控制是否在前端显示该审查要点</strong></td> <td></td></tr> <tr><td>fromModelCalculation</td> <td><strong>是否来自模型计算</strong></td> <td></td> <td></td></tr> <tr><td>reviewPointType</td> <td><strong>审查要点类型编码</strong></td> <td>唯一标识</td> <td>禁止非开发人员修改</td></tr> <tr><td>position</td> <td><strong>排序位置</strong></td> <td><strong>在同一层级中的位置</strong></td> <td>可控制前端审查要点树显示顺序</td></tr> <tr><td>subTitle</td> <td><strong>副标题</strong></td> <td><strong>前端会显示副标题</strong></td> <td></td></tr> <tr><td>modelVersionCode</td> <td><strong>模型版本 code</strong></td> <td>与模型匹配唯一标志</td> <td>严格检查和模型系统中是否一致</td></tr> <tr><td>belongAreaLevel</td> <td><strong>适用的地区层级</strong></td> <td>当前审查要点适用于哪一级别</td> <td>0:国家级,1:省级,2:市级,3:县级,4:乡镇级</td></tr> <tr><td>belongPlanType</td> <td><strong>适用的规划类型</strong></td> <td>当前审查要点适用于哪一规划类型</td> <td>100000:总体规划,200000:专项规划,300000:详细规划</td></tr> <tr><td>participateCalc</td> <td><strong>控制是否参与计算</strong></td> <td>控制是否调用模型进行计算</td> <td></td></tr> <tr><td>hasService</td> <td><strong>是否具有差异图斑服务</strong></td> <td>控制是否参与合并发布服务</td> <td></td></tr> <tr><td>needPublicService</td> <td>是否需要发布服务</td> <td>空间性要点才需要发服务</td> <td></td></tr></tbody></table> <p>新增审查要点的 sql：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> ARS_REVIEW_POINT<span class="token punctuation">(</span>id<span class="token punctuation">,</span> display<span class="token punctuation">,</span> doublescreen<span class="token punctuation">,</span> frommodelcalculation<span class="token punctuation">,</span> leafnode<span class="token punctuation">,</span> participatecalc<span class="token punctuation">,</span>
                             modelversioncode<span class="token punctuation">,</span> parentid<span class="token punctuation">,</span> belongarealevel<span class="token punctuation">,</span> belongplantype<span class="token punctuation">,</span> position<span class="token punctuation">,</span> reviewpointname<span class="token punctuation">,</span>
                             reviewpointtype<span class="token punctuation">,</span> subtitle<span class="token punctuation">,</span> hasservice<span class="token punctuation">,</span> algorithmname<span class="token punctuation">,</span> needpublicservice<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>随便写个id，不要重复就好<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'&lt;需要模型计算的审查要点为Y，不来自为 N&gt;'</span><span class="token punctuation">,</span> <span class="token string">'&lt;叶子节点为Y，非叶子节点为N'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'&lt;模型code&gt;'</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>父目录的id，没有父目录则为<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        <span class="token operator">&lt;</span>规划类型（<span class="token number">100000</span>:总体规划<span class="token punctuation">,</span><span class="token number">200000</span>:专项规划<span class="token punctuation">,</span><span class="token number">300000</span>:详细规划）<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>层级（<span class="token number">0</span>:国家级<span class="token punctuation">,</span><span class="token number">1</span>:省级<span class="token punctuation">,</span><span class="token number">2</span>:市级<span class="token punctuation">,</span><span class="token number">3</span>:县级<span class="token punctuation">,</span><span class="token number">4</span>:乡镇级）<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>同级最大的position<span class="token operator">+</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'&lt;审查要点的名字&gt;'</span><span class="token punctuation">,</span>
        <span class="token operator">&lt;</span>随便编一个不要重复就行<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'&lt;算法名称&gt;'</span><span class="token punctuation">,</span> <span class="token string">'&lt;需要发服务填Y，不需要为N&gt;'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>之后再去要点配置模块进行配置就好了。</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/758ed322093d916e47b1aed32ea4bde7/image-20200921132103539.png" alt="image-20200921132103539" style="zoom:50%;"> <h4 id="_2）如何对接新模型"><a href="#_2）如何对接新模型" class="header-anchor">#</a> 2）如何对接新模型</h4> <p>对接新模型之前一定要确定这个新模型的算法是否已经开发过了，可以问实施这个模型和之前系统上的有没有相同的，确定没有再进行开发。</p> <p>接下来，我们走一下开发新模型的流程：</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/163405ef5d94c908ddec1d2d168a49ea/image-20200921132918607.png" alt="image-20200921132918607" style="zoom:50%;"> <p>从上面的介绍，大家应该知道对接模型的核心是 AcquireTaskInstanceFunctional（封装请求参数） 和 DisposeCalcResultFunctional（解析请求结果） 类，我们先看下 AcquireTaskInstanceFunctional 接口：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AcquireTaskInstanceFunctional</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 获取任务实例code
     *
     * @param reviewTaskId 审查任务id
     * @param reviewPointType    审查要点类型代码
     * @return 模型内边的任务实例code
     */</span>
    <span class="token class-name">String</span> <span class="token function">acquireTaskInstances</span><span class="token punctuation">(</span><span class="token class-name">Long</span> reviewTaskId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> reviewPointType<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 获取当前需要的数据源type
     *
     * @return 数据源types
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDatasourceTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>里面有两个方法，我们先看第二个方法，这个方法是获取这个模型计算时需要的数据源类型，所以<strong>首先我们需要知道：我们要对接的新模型需要哪些数据源，这个信息可以通过实施来知道。</strong></p> <p>我们再看第一个方法，这个方法的作用是封装参数，发送请求获取模型任务实例 code，所以<strong>第二步，我们需要知道需要请求的参数是什么样的，这个信息可以通过模型的开发来知道</strong>，模型开发可能会给你这样格式的请求参数：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;modelVersionCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;模型code&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;realtimeAttributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;accessLayer&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;name\&quot;:\&quot;\&quot;,\&quot;source\&quot;:\&quot;&lt;数据源的code&gt;\&quot;}&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;checkedLayer&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;name\&quot;:\&quot;\&quot;,\&quot;source\&quot;:\&quot;&lt;数据源的code&gt;\&quot;}&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>注：先看下配置文件中配置的这几个地址</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/117018b9b47c9bf5abc2a3ba865baee5/image-20200921134932890.png" alt="image-20200921134932890" style="zoom:50%;"> <p>写代码前可以先通过这几个接口先检查一下这个新模型是否可以正常的运行并返回结果。</p> <p>swagger 地址分别为：</p> <p>http://52.82.98.186:7321/swagger/index.html</p> <p>http://52.82.98.186:7322/swagger/index.html</p></blockquote> <p>有了请求的参数我们就可以编写 AcquireTaskInstanceFunctional 类的实现，通过接口返回的结果我们也能编写 DisposeCalcResultFunctional 了。</p> <p><strong>之后我们需要新增一个 ModelCalcTask 类，使用 Spring 的依赖注入将刚刚写好的 AcquireTaskInstanceFunctional 和 DisposeCalcResultFunctional 注入进去</strong>，像这样：</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/40d50ce9ee6cd7269ebb03fcb6b6185e/image-20200921140430612.png" alt="image-20200921140430612" style="zoom:50%;"> <p>AbstractModelCalcTask 类还有一个抽象方法 getTypes()，这个方法会返回这个类能够计算的审查要点类型，所以还需要在 ReviewPointTypeProperties 类中添加一个 getTypes10() 方法。</p> <p>ReviewPointTypeProperties 类对应的是配置文件的这个地方：</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/92dbc308c401070506c240a95ff0e883/image-20200918160209256.png" alt="image-20200918160209256" style="zoom:50%;"> <p>最后，我们需要在下面这个地方配置上新写的计算规则：</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/7d4075d1cf5400fd792127471b0237fc/image-20200921140908913.png" alt="image-20200921140908913" style="zoom:50%;"> <h5 id="总结："><a href="#总结：" class="header-anchor">#</a> 总结：</h5> <ol><li>问实施/模型开发这个新模型使用到的数据源有哪些</li> <li>问模型开发，这个新模型的请求参数是什么样的，与数据源 code 之间的对应关系是啥</li> <li>知道了这两点，就可以写 AcquireTaskInstanceFunctional 类的实现了，假设是 AcquireTaskInstanceFunctional10</li> <li>从这个可以看到模型计算的结果是什么样的（当然也可以通过接口获取到，上面已经说了），这样就可以写 DisposeCalcResultFunctional 类的实现，假设是 DisposeCalcResultFunctional10。</li></ol> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/2887d6815317bafad7615ddd615561f2/image-20200921141339560.png" alt="image-20200921141339560" style="zoom:50%;"> <ol start="5"><li>有了这两个就可以写 AbstractModelCalcTask 的实现，假设是 ModelCalcTask10，将上面新写的 2 个类通过依赖注入注入进去。</li> <li>在 ReviewPointTypeProperties 类中新增 getTypes10() 方法，返回能由新增的计算规则计算的模型的审查要点类型。</li> <li>将新写的 ModelCalcTask10 配置到 <code>META-INF/services/com.dist.ars.manager.remote.mms2.modelCalcTask.AbstractModelCalcTask</code> 文件中。</li></ol> <h4 id="文件预览"><a href="#文件预览" class="header-anchor">#</a> 文件预览</h4> <p>在我们配置的审查要点中有两项是辅助性模型里面的，计算这两项的目的就是为了对规划成果中 mdb 和 gdb 文件进行预览。</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/0a05f322992fdcd0fbaae142a1ca8083/image-20200921143625136.png" alt="image-20200921143625136" style="zoom:50%;"> <h5 id="mdb-文件预览"><a href="#mdb-文件预览" class="header-anchor">#</a> mdb 文件预览</h5> <p>对应的 Command 为 TableAchievementCommand，这个 command 主要的作用就是根据 reviewTaskId 和 MDB 表格解析对应的 reviewPointId 获取计算结果返回前端。</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/de66d53a4b014d52ba30bd6114a443fd/image-20200921144101753.png" alt="image-20200921144101753" style="zoom:50%;"> <h5 id="gdb-文件预览"><a href="#gdb-文件预览" class="header-anchor">#</a> gdb 文件预览</h5> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/9d1f52770684939bef9c4b763dfedff2/image-20200921144352186.png" alt="image-20200921144352186" style="zoom:50%;"> <p>所以 gdb 文件预览分为两个部分，一个是获取自动发服务发出来的地图服务，前端请求流程如下：</p> <ol><li>请求 /v2/reviewTask/mapService/{reviewTaskId} 获取地图发布状态</li> <li>请求 /v1/reviewPoint/serverUrl/{reviewTaskId} 获取服务名称</li> <li>根据服务名称拼接地址获取 gdb 服务。</li></ol> <p>第二个是 GDB 图层解析模型计算出来的几个图层信息，对应的 Command 为 VectorDataCommand。</p> <img src="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/eb6cbaa6f29fe14f75b7a62f4f351fd7/image-20200921144655354.png" alt="image-20200921144655354" style="zoom:50%;"> <blockquote><p>注意：因为自动发出来的服务也有图层信息，如果我们返回给前端图层信息数组不为空，那么将会取交集，如果返回的数组为空，则会直接使用发出来服务的图层信息。</p></blockquote></div> <div class="content edit-link"><a href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/edit/master/docs/doc-backend/production/guotu.StartModelCalculate.md" target="_blank" rel="noopener noreferrer">
      编辑此页面
    </a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="content page-nav"><p class="inner"><span class="prev"><a href="/doc-backend/production/" class="prev router-link-active">&lt; 简介</a></span> <span class="next"><a href="/doc-backend/production/guotu.AuxiliaryReviewSystem.html">
          辅助审查系统
          &gt;
        </a></span></p></div> <div class="footer">数据中心 研发二部</div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.24ab3d2f.js" defer></script><script src="/assets/js/3.ae223e66.js" defer></script><script src="/assets/js/1.02cf7ae9.js" defer></script><script src="/assets/js/49.4a0ef904.js" defer></script>
  </body>
</html>
